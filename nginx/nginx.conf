worker_processes auto;

events {
    worker_connections 1024;
}

http {
    # Bloc pour la redirection HTTP vers HTTPS
    server {
        listen 80;
        server_name localhost;

        # Redirection vers HTTPS
        return 301 https://localhost$request_uri;
    }

    # Bloc pour HTTPS
    server {
        listen 443 ssl;
        server_name localhost;

        # Certificats SSL
        ssl_certificate /etc/nginx/certs/server.crt;
        ssl_certificate_key /etc/nginx/certs/server.key;

        # Inclure les types MIME standard
        include /etc/nginx/mime.types;

        # Serveur Frontend
        location / {
            root /usr/share/nginx/html;
            index index.html;
        }

        # Reverse Proxy vers "player"
        location /player/ {
            proxy_pass http://player:8000/;
        }

        # Reverse Proxy vers "authentication"
        location /authentication/ {
            proxy_pass http://authentication:8001/;
        }

		location /ws/online/ {
			proxy_pass http://authentication:8001/ws/online/;
			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";
			proxy_set_header Host $host;
		}


        # ðŸ“Œ Correction : Alias pour les fichiers statiques
        location /static/ {
            alias /usr/src/app/static/;
        }

        # ðŸ“Œ ðŸ”¥ **Correction ici : Servir les fichiers mÃ©dias correctement**
        location /player/media/ {
            alias /usr/src/app/media/;
            autoindex on;  # Optionnel : permet de lister les fichiers dans le navigateur
            access_log off;
            expires max;
        }
    }
}


